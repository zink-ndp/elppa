!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rowIndex=t,this.container=i,this.label=r,this.header=this.container.find(".repeatable-row-header"),this.addEventListener().updateLabel()}var i,r,n;return i=e,(r=[{key:"setRowIndex",value:function(e){return this.rowIndex=e,this.container.attr("data-row",e),this.container.data("row",e),this.updateLabel(),this}},{key:"toggleMinimize",value:function(){return this.container.toggleClass("minimized"),this.header.find(".dashicons").toggleClass("dashicons-arrow-up").toggleClass("dashicons-arrow-down"),this}},{key:"remove",value:function(){return this.container.slideUp(300,(function(){jQuery(this).detach()})),this.container.trigger("row:remove",[this.rowIndex]),this}},{key:"updateLabel",value:function(){return this.header.find(".repeatable-row-label").text(this.label+" "+(this.rowIndex+1)),this}},{key:"addEventListener",value:function(){var e=this;return this.header.on("click",(function(){e.toggleMinimize()})),this.header.on("mousedown",(function(){e.container.trigger("row:start-dragging")})),this.container.on("click",".repeatable-row-remove",(function(){e.remove()})),this.container.on("input change","input, select, textarea",(function(t){e.container.trigger("row:update",[e.rowIndex,jQuery(t.target).data("field"),t.target])})),this}}])&&t(i.prototype,r),n&&t(i,n),Object.defineProperty(i,"prototype",{writable:!1}),e}(),r={toggle:function(e){e==this.params.required[1]?this.container.show():this.container.hide()},ready:function(){var e=this;this.params.required&&wp.customize(this.params.required[0],(function(t){e.toggle(t.get()),t.bind((function(t){e.toggle(t)}))})),this.settingField=this.container.find("[data-customize-setting-link]").first(),this.repeatableFieldsContainer=this.container.find(".repeatable-fields").first(),this.currentIndex=0,this.rows=[];var t=this.params.limit;this.container.on("click","button.repeatable-add",(function(i){i.preventDefault(),!t||e.currentIndex<t?e.addRow().toggleMinimize():jQuery(e.selector+" .limit").addClass("highlight")})),this.container.on("click",".repeatable-row-remove",(function(i){e.currentIndex--,(!t||e.currentIndex<t)&&jQuery(e.selector+" .limit").removeClass("highlight")}));var i=this;this.repeatableTemplate=_.memoize((function(){var e={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(t){return _.template(i.container.find(".customize-control-repeatable-content").first().html(),null,e)(t)}}));var r=this.getValue();r.length&&_.each(r,(function(t){e.addRow(t)})),this.repeatableFieldsContainer.sortable({handle:".repeatable-row-header",update:function(t,i){return e.sort()},axis:"y"})},getValue:function(){if(this.setting.get())try{return JSON.parse(decodeURI(this.setting.get()))}catch(e){return console.info("JSON PARSING ISSUE:",e),[]}return[]},setValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setting.set(encodeURI(JSON.stringify(e))),t&&this.settingField.trigger("change")},addRow:function(e){var t=this,r=this.repeatableTemplate(),n=this.getValue(),a={};if(r){var o=jQuery.extend(!0,{},this.params.fields);if(e)for(var s in e)e.hasOwnProperty(s)&&o.hasOwnProperty(s)&&(o[s].default=e[s]);o.index=this.currentIndex,r=r(o);var l=new i(this.currentIndex,jQuery(r).appendTo(this.repeatableFieldsContainer),this.params.row_label);for(var c in l.container.on("row:remove",(function(e,i){t.deleteRow(i)})),l.container.on("row:update",(function(e,i,r,n){t.updateField(e,i,r,n)})),this.rows[this.currentIndex]=l,o)o.hasOwnProperty(c)&&(a[c]=o[c].default);return n[this.currentIndex]=a,this.setValue(n,!0),this.currentIndex++,l}},sort:function(){var e=this,t=this.repeatableFieldsContainer.find(".repeatable-row"),i=[],r=this.getValue(),n=[],a=[];t.each((function(e,t){i.push(jQuery(t).data("row"))})),jQuery.each(i,(function(t,i){n[t]=e.rows[i],n[t].setRowIndex(t),a[t]=r[i]})),this.rows=n,this.setValue(a)},deleteRow:function(e){var t=this,i=this.getValue();i[e]&&(this.rows[e]&&(i.splice(e,1),this.rows.splice(e,1),this.setValue(i,!0)));this.rows.map((function(e,i){return t.rows[i].setRowIndex(i)}))},updateField:function(e,t,i,r){if(this.rows[t]&&this.params.fields[i]){var n=this.params.fields[i].type,a=this.rows[t],o=this.getValue(),s=jQuery(r);void 0!==o[a.rowIndex][i]&&(o[a.rowIndex][i]="checkbox"===n?s.is(":checked"):s.val(),this.setValue(o,!0))}},initColorPicker:function(){"use strict";var t=this,i=t.container.find(".color-picker-hex"),r={},n=i.data("field");void 0!==n&&void 0!==t.params.fields[n]&&void 0!==t.params.fields[n].palettes&&"object"===e(t.params.fields[n].palettes)&&(r.palettes=t.params.fields[n].palettes),r.change=function(e,i){var r=jQuery(e.target),n=r.closest(".repeatable-row").data("row"),a=t.getValue();a[n][r.data("field")]=i.color.toString(),t.setValue(a,!0)},0!==i.length&&i.wpColorPicker(r)},initDropdownPages:function(e,t){"use strict";var i,r,n=this,a=e.container.find(".repeatable-dropdown-pages select");0!==a.length&&(i=jQuery(a).selectize()[0].selectize,r=a.data("field"),t&&i.setValue(t[r]),this.container.on("change",".repeatable-dropdown-pages select",(function(e){var t=jQuery(e.target),i=t.closest(".repeatable-row").data("row"),r=n.getValue();r[i][t.data("field")]=jQuery(this).val(),n.setValue(r)})))}};wp.customize.controlConstructor.repeatable=wp.customize.Control.extend(r)}();